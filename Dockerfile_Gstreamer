# Use Debian 12 (Bookworm) as base image- This matches Raspberry Pi OS and has GStreamer readily available
FROM debian:bookworm-slim

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install GStreamer and required dependencies
RUN apt-get update && apt-get install -y \
    # Core GStreamer packages
    gstreamer1.0-tools \
    gstreamer1.0-plugins-base \
    gstreamer1.0-plugins-good \
    gstreamer1.0-plugins-bad \
    gstreamer1.0-x \
    # Python and GStreamer bindings
    python3 \
    python3-gi \
    python3-gi-cairo \
    gir1.2-gstreamer-1.0 \
    gir1.2-gst-plugins-base-1.0 \
    # X11 libraries for display
    libx11-6 \
    libxv1 \
    # Clean up to reduce image size
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Create a working directory for our application
WORKDIR /app

# Copy the Python script into the container
COPY src/webcam_preview.py .

# Make the script executable
RUN chmod +x webcam_flip.py.py

# Set the command to run when container starts
CMD ["python3", "webcam_flip.py"]

